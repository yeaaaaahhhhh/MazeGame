<!DOCTYPE html>
<html>

<head>
    <title>0216 project</title>
    <link href="./style.css" rel="stylesheet">
</head>

<body>
    <canvas id="canv"></canvas>
    <script src="scripts.js"></script>


    <script type="module">
        "use strict"
        import Input from './engine/Input.js'
        import time from './engine/time.js'
        import Circle from './engine/Circle.js'
        import Constants from './Game/Constants.js'
        import PlayerGameObject from './Game/PlayerGameObject.js'
        import RectangleGameObject from './Game/RectangleGameObject.js'

        Input.attach(document);
        //document.addEventListener("keypress", keyPressed)

        let px = 225;
        let py = 115;

        let timeCounter = setInterval(draw, time.millisecondsBetweenFrames)

        let gameObjects = []

        let { canvas, ctx } = getCanvas();
        let player = new PlayerGameObject(px, py, 15)

        function draw() {
            //console.log("draw")
            if (Constants.endOfGame == false) {

                ctx.fillStyle = "black"
                ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height)
                ctx.fillStyle = "white"
                ctx.font = "30px Arial"
                ctx.fillText("Time : " + Math.round((time.timePassed * 100) / 100), 30, 30)
                for (let rect of Constants.walls) {
                    rect.draw(ctx)
                }
                player.update()
                player.draw(ctx)
                for (let rect of Constants.darkRect) {
                    rect.draw(ctx)
                }
                Input.update()
                time.timePassed += time.secondsBetweenFrame
            }
            else {
                clearInterval(timeCounter)
                drawEnd()
            }
        }

        function drawEnd() {
            //ctx.clearRect(0,0,1000,1000)
            ctx.fillStyle = "black"
            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height)
            ctx.fillStyle = "white"
            ctx.font = "50px Arial"
            ctx.fillText("Congratulation! Your time record is " + Math.round((time.timePassed * 100) / 100), 200, 200);
        }

        pushWall()
        pushDarkness()
        
        function pushWall() {
            Constants.walls.push(new RectangleGameObject(100, 100, 10, 400, "yellow"))
            Constants.walls.push(new RectangleGameObject(100, 100, 100, 10, "white"))
            Constants.walls.push(new RectangleGameObject(250, 100, 350, 10, "blue"))
            Constants.walls.push(new RectangleGameObject(600, 100, 10, 410, "white"))
            Constants.walls.push(new RectangleGameObject(100, 500, 350, 10, "white"))
            Constants.walls.push(new RectangleGameObject(500, 500, 100, 10, "white"))

            //maze map
            Constants.walls.push(new RectangleGameObject(195, 100, 10, 60, "white"))
            Constants.walls.push(new RectangleGameObject(245, 100, 10, 100, "white"))
            Constants.walls.push(new RectangleGameObject(245, 195, 50, 10, "white"))
            Constants.walls.push(new RectangleGameObject(300, 150, 50, 10, "white"))
            Constants.walls.push(new RectangleGameObject(350, 150, 10, 100, "white"))
            Constants.walls.push(new RectangleGameObject(150, 250, 210, 10, "white"))
            Constants.walls.push(new RectangleGameObject(150, 250, 210, 10, "white"))
            Constants.walls.push(new RectangleGameObject(150, 250, 10, 50, "white"))
            Constants.walls.push(new RectangleGameObject(150, 300, 50, 10, "white"))
            Constants.walls.push(new RectangleGameObject(150, 350, 100, 10, "white"))
            Constants.walls.push(new RectangleGameObject(250, 250, 10, 150, "white"))
            Constants.walls.push(new RectangleGameObject(250, 400, 50, 10, "white"))
            Constants.walls.push(new RectangleGameObject(100, 400, 100, 10, "white"))
            Constants.walls.push(new RectangleGameObject(150, 450, 150, 10, "white"))
            Constants.walls.push(new RectangleGameObject(300, 450, 10, 50, "white"))
            Constants.walls.push(new RectangleGameObject(350, 400, 10, 50, "white"))
            Constants.walls.push(new RectangleGameObject(350, 450, 50, 10, "white"))
            Constants.walls.push(new RectangleGameObject(400, 400, 10, 50, "white"))
            Constants.walls.push(new RectangleGameObject(400, 400, 150, 10, "white"))
            Constants.walls.push(new RectangleGameObject(500, 400, 10, 50, "white"))
            Constants.walls.push(new RectangleGameObject(450, 450, 10, 50, "white"))
            Constants.walls.push(new RectangleGameObject(450, 450, 50, 10, "white"))
            Constants.walls.push(new RectangleGameObject(400, 150, 10, 200, "white"))
            Constants.walls.push(new RectangleGameObject(300, 300, 200, 10, "white"))
            Constants.walls.push(new RectangleGameObject(300, 300, 10, 50, "white"))
            Constants.walls.push(new RectangleGameObject(300, 350, 50, 10, "white"))
            Constants.walls.push(new RectangleGameObject(400, 150, 50, 10, "white"))
            Constants.walls.push(new RectangleGameObject(450, 150, 10, 100, "white"))
            Constants.walls.push(new RectangleGameObject(500, 100, 10, 100, "white"))
            Constants.walls.push(new RectangleGameObject(550, 150, 10, 50, "green"))
            Constants.walls.push(new RectangleGameObject(550, 150, 50, 10, "green"))
            Constants.walls.push(new RectangleGameObject(500, 250, 100, 10, "white"))
            Constants.walls.push(new RectangleGameObject(400, 350, 50, 10, "white"))
            Constants.walls.push(new RectangleGameObject(450, 350, 10, 50, "white"))
            Constants.walls.push(new RectangleGameObject(500, 300, 10, 50, "white"))
            Constants.walls.push(new RectangleGameObject(550, 300, 10, 100, "white"))
            Constants.walls.push(new RectangleGameObject(550, 450, 10, 50, "white"))


            Constants.walls.push(new RectangleGameObject(150, 140, 10, 60, "white"))
            Constants.walls.push(new RectangleGameObject(100, 195, 105, 10, "white"))

        }

        function pushDarkness() {
            for (let x = 105; x < 600; x = x + 50) {
                for (let y = 105; y < 500; y = y + 50) {
                    Constants.darkRect.push(new RectangleGameObject(x, y, 50, 50, "grey"))
                }
            }
        }
    </script>
</body>

</html>